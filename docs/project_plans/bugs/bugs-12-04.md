# Identified Bugs - /gifts Navigation Crash

**Date:** 2025-12-04
**Previously Fixed Commit:** 77d88b9
**Prior Fix Attempts:** `.claude/worknotes/fixes/bug-fixes-2025-12.md`

## Context

This bug has persisted across numerous fix attempts, and even the recent overhaul of the codebase to simplify the websocket implementation - `docs/project_plans/implementation_plans/refactors/websocket-simplification-v1.md`.

It was originally fixed in commit 77d88b9, but has since re-emerged. The bug manifests when navigating to /gifts, and then attempting to navigate to /occasions, /people, or /lists using the sidebar buttons, which causes an immediate crash of the site. The crash does not occur when navigating directly via URL or using other navigation methods, or to other pages.

**Current Status:** Fixed by lazy-rendering all nested modals and gating person/occasion detail fetches in `ListDetailModal.tsx`. See bug-fixes entry "Gifts Navigation Crash - Hidden List Modals Spawning Portals".

The current bug was introduced in commit `80ecb0a19dc9d9eb091e3e5767ab1636a7605337`. Specifically, it seems to be related to the updates made to `ListDetailModal.tsx`.

## Listed Items

1. Once a user navigates to /gifts, navigating to /occasions, /people, or /lists using sidebar buttons will immediately crash the site.
    - When I first refresh the site on /gifts after a failure, these are the immediate API calls:

    ```log
    INFO:     172.22.0.1:60086 - "GET /api/v1/auth/me HTTP/1.1" 200 OK
    INFO:     172.22.0.1:60134 - "WebSocket /ws?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxIiwiZXhwIjoxNzY0ODcwODQ5LCJpYXQiOjE3NjQ3ODQ0NDl9.EuEAS37LdHWT-ieL3GYEzz3CgunY0uB37Zou1WqYk7w" [accepted]
    INFO:     connection open
    INFO:     172.22.0.1:60086 - "GET /api/v1/persons HTTP/1.1" 200 OK
    INFO:     172.22.0.1:60116 - "GET /api/v1/occasions HTTP/1.1" 200 OK
    INFO:     172.22.0.1:60120 - "GET /api/v1/gifts?sort=recent HTTP/1.1" 200 OK
    INFO:     172.22.0.1:60100 - "GET /api/v1/lists HTTP/1.1" 200 OK
    ```

    - Current behaviors once on the /gifts page:
      - Navigating to /occasions, /people, or /lists using sidebar buttons will immediately crash.
      - I'm able to click on a gift card and the modal opens, which then fetches that /gifts/{id} endpoint, the /lists, and all /lists/{id} endpoints without a crash.
      - I can also then navigate to /dashboard and /assignments and even back to /gifts without crashing.
      - I can navigate to the /{id} pages for each of the 3 pages via buttons on the site, or directly via URL, without crash.
      - I can navigate to the 3 pages directly via URL without the site failing at any time.
      - The crash only occurs if I navigate to the above 3 sites via the side buttons, from any page, after navigating to /gifts.
      - It also occurs if, while on /gifts, I click on a linked List from within a Gift modal, which navigates to /lists/{id}. But I can still navigate to that page directly via URL without crash.
